
function cars = updateCars(cars, nodes, roads, routes)
  global positionIndex;
  global roadIndex;
  global maxVelocityIndex;
  global currentVelocityIndex;
  global maxAccelerationIndex;
  global maxDeacelerationIndex;
  global visionIndex;
  global nextRoadIndex;
  global nextRoadInRouteIndex;


  cars = -sortrows(-cars, [2 1]);
  roadLengths = calculateRoadLength(nodes, roads);
  
  acceleration = updateAcceleration(cars, nodes, roads);%checkCollision(cars);
  
  %carsAtIntersection = intersection(cars, roadLengths);

  cars = updateVelocity(cars,acceleration);
  
  cars = updatePosition(cars,nodes,roads,routes);
    
  route = routes(1,:);
  startNode = roads(cars(1,roadIndex),2);
  index = find(route == 0)
  stopNode = roads(route(index(1)),2);
  route = uppdateRoutes(cars,1,route,startNode,stopNode,nodes,roads,networkMatrix)
  
end
